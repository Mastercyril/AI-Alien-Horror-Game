/**
 * DAILY AUTO-BUILD PIPELINE
 * =====================================
 * Runs daily (or on demand) to:
 * 1. Generate new NPC conversations
 * 2. Create new investigation leads
 * 3. Advance K'Thaal's intelligence
 * 4. Add new locations/scenes
 * 5. Update Perplexity Space with progress
 * 6. Commit to GitHub automatically
 * 
 * This ensures the game NEVER stops growing.
 */

class DailyAutoBuildPipeline {
  constructor(config = {}) {
    this.config = {
      enabled: config.enabled !== false,
      autoRunTime: config.autoRunTime || '08:00', // 8 AM UTC
      perplexityEnabled: config.perplexityEnabled !== false,
      githubEnabled: config.githubEnabled !== false,
      kThaalLearningRate: config.kThaalLearningRate || 0.15,
      newNPCsPerDay: config.newNPCsPerDay || 1,
      newLocationsPerDay: config.newLocationsPerDay || 1,
      newQuestsPerDay: config.newQuestsPerDay || 2,
      ...config
    };\n
    this.buildLog = [];\n    this.lastBuildDate = this.getLastBuildDate();\n    this.currentBuildDate = new Date();\n    this.generatedContent = {\n      npcs: [],\n      locations: [],\n      quests: [],\n      dialogues: [],\n      events: [],\n      kThaalProgression: {}\n    };\n  }\n\n  /**\n   * MAIN ENTRY POINT\n   * Orchestrates the entire daily build\n   */\n  async executeDailyBuild() {\n    console.log('üéÆ DESTINY WORLD: DAILY BUILD STARTING...');\n    const startTime = Date.now();\n\n    try {\n      // Step 1: Generate new NPCs\n      await this.generateNewNPCs();\n      \n      // Step 2: Generate new locations\n      await this.generateNewLocations();\n      \n      // Step 3: Generate new quests\n      await this.generateNewQuests();\n      \n      // Step 4: Advance K'Thaal intelligence\n      await this.advanceKThaalAI();\n      \n      // Step 5: Generate dialogue variations\n      await this.generateDialogueVariations();\n      \n      // Step 6: Create story events\n      await this.generateStoryEvents();\n      \n      // Step 7: Save build data\n      await this.saveBuildData();\n      \n      // Step 8: Update Perplexity Space\n      if (this.config.perplexityEnabled) {\n        await this.updatePerplexitySpace();\n      }\n      \n      // Step 9: Commit to GitHub\n      if (this.config.githubEnabled) {\n        await this.commitToGithub();\n      }\n      \n      // Step 10: Generate daily report\n      const report = this.generateBuildReport(startTime);\n      \n      console.log('‚úÖ DAILY BUILD COMPLETED SUCCESSFULLY');\n      console.log(report);\n      \n      return { success: true, report };\n\n    } catch (error) {\n      console.error('‚ùå DAILY BUILD FAILED:', error);\n      this.buildLog.push({\n        timestamp: new Date().toISOString(),\n        status: 'FAILED',\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * STEP 1: Generate new NPCs with unique personalities\n   */\n  async generateNewNPCs() {\n    console.log('üë• Generating new NPCs...');\n    \n    for (let i = 0; i < this.config.newNPCsPerDay; i++) {\n      const npc = await this.createUniquNPC();\n      this.generatedContent.npcs.push(npc);\n      \n      // Integrate into game\n      window.gameManager.npcs.set(npc.id, npc);\n      \n      this.log(`‚ú® Created NPC: ${npc.name} (${npc.role})`);\n    }\n  }\n\n  /**\n   * Generate a unique NPC using Perplexity Sonar\n   */\n  async createUniquNPC() {\n    const npcTypes = [\n      'survivor',\n      'cultist',\n      'investigator',\n      'scientist',\n      'citizen',\n      'merchant',\n      'stranger'\n    ];\n\n    const npcType = npcTypes[Math.floor(Math.random() * npcTypes.length)];\n    const dayNumber = window.gameManager.state.gameDay;\n\n    // Call Perplexity Sonar for creative NPC generation\n    const prompt = `Generate a unique horror game NPC for day ${dayNumber}. Type: ${npcType}. 
                    Context: Ancient alien serial killer K'Thaal is loose. Player is investigating.\\n\n    Provide JSON with:\n    {\n      \"name\": \"Full Name\",\n      \"role\": \"Job/Title\",\n      \"personality\": \"Brief description\",\n      \"suspicion_level\": 0-100,\n      \"loyalties\": [\"faction1\", \"faction2\"],\n      \"secrets\": \"Their hidden knowledge/agenda\",\n      \"dialogue_quirk\": \"Unique way they speak\",\n      \"quest_relevance\": \"How they help/hinder investigation\"\n    }`;\n\n    try {\n      // Simulate Sonar call (in production, use actual API)\n      const response = await this.callPerplexitySonar(prompt);\n      const npcData = JSON.parse(response);\n\n      return {\n        id: `npc_${this.currentBuildDate.getTime()}_${i}`,\n        ...npcData,\n        createdDate: this.currentBuildDate,\n        canBeSuspect: npcData.suspicion_level > 50,\n        faction: npcData.loyalties[0] || 'neutral',\n        relationship: Math.floor(Math.random() * 100) - 50,\n        location: this.selectRandomLocation(),\n        schedule: this.generateNPCSchedule(),\n        dialogue: this.generateNPCDialogue(npcData)\n      };\n    } catch (error) {\n      console.warn('Failed to generate NPC via Sonar, using fallback');\n      return this.generateFallbackNPC(npcType);\n    }\n  }\n\n  /**\n   * STEP 2: Generate new locations\n   */\n  async generateNewLocations() {\n    console.log('üó∫Ô∏è  Generating new locations...');\n    \n    for (let i = 0; i < this.config.newLocationsPerDay; i++) {\n      const location = await this.createNewLocation();\n      this.generatedContent.locations.push(location);\n      window.gameManager.locations.set(location.id, location);\n      \n      this.log(`üìç Created Location: ${location.name}`);\n    }\n  }\n\n  async createNewLocation() {\n    const locationTypes = [\n      'abandoned_building',\n      'ritual_site',\n      'safe_house',\n      'research_facility',\n      'underground_bunker',\n      'cult_temple',\n      'alien_artifact_site'\n    ];\n\n    const type = locationTypes[Math.floor(Math.random() * locationTypes.length)];\n    const dayNumber = window.gameManager.state.gameDay;\n\n    const prompt = `Generate a creepy location for horror investigation game. Type: ${type}. Day: ${dayNumber}\\n\n    JSON format:\n    {\n      \"name\": \"Location Name\",\n      \"description\": \"Atmospheric description\",\n      \"danger_level\": 0-100,\n      \"connected_to_kthaal\": true/false,\n      \"hidden_clues\": [\"clue1\", \"clue2\"],\n      \"npcs_found_here\": [\"npc_ids\"],\n      \"loot\": [\"item1\", \"item2\"],\n      \"environmental_hazards\": [\"hazard1\"]\n    }`;\n\n    try {\n      const response = await this.callPerplexitySonar(prompt);\n      const locationData = JSON.parse(response);\n\n      return {\n        id: `loc_${this.currentBuildDate.getTime()}_${i}`,\n        ...locationData,\n        createdDate: this.currentBuildDate,\n        explored: false,\n        cluesFound: [],\n        inhabitants: locationData.npcs_found_here || [],\n        exits: this.generateLocationExits(),\n        lighting: this.generateLighting(locationData.danger_level)\n      };\n    } catch (error) {\n      return this.generateFallbackLocation(type);\n    }\n  }\n\n  /**\n   * STEP 3: Generate new quests\n   */\n  async generateNewQuests() {\n    console.log('üìã Generating new quests...');\n    \n    for (let i = 0; i < this.config.newQuestsPerDay; i++) {\n      const quest = await this.createNewQuest();\n      this.generatedContent.quests.push(quest);\n      \n      // Add to an NPC or as a world event\n      if (quest.givenBy) {\n        const npc = window.gameManager.npcs.get(quest.givenBy);\n        if (npc) {\n          npc.questsOffered = npc.questsOffered || [];\n          npc.questsOffered.push(quest.id);\n        }\n      }\n      \n      this.log(`‚öîÔ∏è  Created Quest: ${quest.title}`);\n    }\n  }\n\n  async createNewQuest() {\n    const questTypes = [\n      'investigation',\n      'survival',\n      'rescue',\n      'betrayal',\n      'revelation',\n      'choice'\n    ];\n\n    const type = questTypes[Math.floor(Math.random() * questTypes.length)];\n\n    const prompt = `Create a branching quest for horror game. Type: ${type}. Alien killer context.\\n\n    JSON:\n    {\n      \"title\": \"Quest Name\",\n      \"description\": \"Quest description\",\n      \"type\": \"${type}\",\n      \"objectives\": [\"objective1\", \"objective2\"],\n      \"rewards\": {\"alignment_shift\": -10, \"information\": \"what player learns\"},\n      \"consequences\": {\"if_refused\": \"what happens\", \"if_failed\": \"failure outcome\"},\n      \"alignment_impact\": -50 to 50,\n      \"connects_to_kthaal\": true/false\n    }`;\n\n    try {\n      const response = await this.callPerplexitySonar(prompt);\n      return JSON.parse(response);\n    } catch (error) {\n      return this.generateFallbackQuest(type);\n    }\n  }\n\n  /**\n   * STEP 4: Advance K'Thaal's intelligence\n   */\n  async advanceKThaalAI() {\n    console.log('üî¥ Advancing K\\'Thaal intelligence...');\n    \n    const kthaal = window.gameManager.characters.kThaal;\n    \n    // K'Thaal learns from each day that passes\n    kthaal.adaptationLevel = Math.min(\n      100,\n      kthaal.adaptationLevel + this.config.kThaalLearningRate * 10\n    );\n\n    // K'Thaal develops new hunting tactics\n    const newTactic = this.generateAdaptedHuntingTactic();\n    \n    // K'Thaal recruits more followers as time passes\n    if (kthaal.adaptationLevel > 40 && Math.random() > 0.7) {\n      const recruitedNPC = this.selectNPCForRecruitment();\n      if (recruitedNPC) {\n        recruitedNPC.loyalty = 'kthaal';\n        recruitedNPC.faction = 'kthaal_cult';\n        kthaal.followers = kthaal.followers || [];\n        kthaal.followers.push(recruitedNPC.id);\n        this.log(`‚ö†Ô∏è  K'Thaal recruited: ${recruitedNPC.name}`);\n      }\n    }\n\n    // K'Thaal's psychological understanding deepens\n    const playerProfile = this.analyzePlayerBehavior();\n    kthaal.playerProfile = playerProfile;\n\n    this.generatedContent.kThaalProgression = {\n      adaptationLevel: kthaal.adaptationLevel,\n      newTactic: newTactic,\n      followersCount: kthaal.followers.length,\n      playerProfile: playerProfile\n    };\n\n    this.log(`‚ö° K'Thaal adaptation: ${kthaal.adaptationLevel.toFixed(1)}%`);\n  }\n\n  generateAdaptedHuntingTactic() {\n    const tactics = [\n      {\n        name: 'Psychological Manipulation',\n        description: 'K\\'Thaal uses player\\'s emotions against them',\n        effectiveness: 0.8\n      },\n      {\n        name: 'Follower Coordination',\n        description: 'Cult members hunt in coordinated patterns',\n        effectiveness: 0.7\n      },\n      {\n        name: 'Environmental Mastery',\n        description: 'K\\'Thaal controls the hunting grounds perfectly',\n        effectiveness: 0.9\n      },\n      {\n        name: 'Predictive Hunting',\n        description: 'K\\'Thaal anticipates player movements',\n        effectiveness: 0.85\n      },\n      {\n        name: 'Time Distortion',\n        description: 'K\\'Thaal warps perception of time itself',\n        effectiveness: 0.95\n      }\n    ];\n\n    return tactics[Math.floor(Math.random() * tactics.length)];\n  }\n\n  /**\n   * STEP 5: Generate dialogue variations\n   */\n  async generateDialogueVariations() {\n    console.log('üí¨ Generating dialogue variations...');\n    \n    // Generate new K'Thaal dialogue lines\n    const kthaalDialogue = await this.generateKThaalDialogue();\n    this.generatedContent.dialogues.push(kthaalDialogue);\n    \n    // Generate NPC banter\n    const npcBanter = await this.generateNPCBanter();\n    this.generatedContent.dialogues.push(...npcBanter);\n    \n    this.log(`‚úçÔ∏è  Generated ${kthaalDialogue.length + npcBanter.length} new dialogue lines`);\n  }\n\n  async generateKThaalDialogue() {\n    const kthaal = window.gameManager.characters.kThaal;\n    const dayNumber = window.gameManager.state.gameDay;\n    \n    const prompt = `Generate dark, haunting dialogue lines for K'Thaal (10,000 year old alien serial killer). \n                    Day ${dayNumber} of confrontation. Adaptation level: ${kthaal.adaptationLevel}%\\n\n    Return JSON array of dialogue objects:\n    [{\n      \"line\": \"The exact dialogue\",\n      \"context\": \"When this would be spoken\",\n      \"emotion\": \"K'Thaal's emotional state\",\n      \"threat_level\": 0-100\n    }]`;\n\n    try {\n      const response = await this.callPerplexitySonar(prompt);\n      return JSON.parse(response);\n    } catch (error) {\n      return [];\n    }\n  }\n\n  /**\n   * STEP 6: Generate story events\n   */\n  async generateStoryEvents() {\n    console.log('üìñ Generating story events...');\n    \n    const events = [\n      this.generateMurderEvent(),\n      this.generateCultEvent(),\n      this.generateAllySuspicionEvent(),\n      this.generateAlienArtifactEvent(),\n      this.generatePlayerDream()\n    ];\n\n    for (const event of events) {\n      if (event && Math.random() > 0.5) { // 50% chance each day\n        this.generatedContent.events.push(event);\n        this.log(`üìç Story Event: ${event.name}`);\n      }\n    }\n  }\n\n  generateMurderEvent() {\n    return {\n      name: 'Mysterious Death',\n      type: 'murder',\n      severity: Math.floor(Math.random() * 100),\n      victim: this.selectRandomNPC(),\n      location: this.selectRandomLocation(),\n      clues: ['blood_evidence', 'strange_symbols'],\n      investigation_weight: 30\n    };\n  }\n\n  /**\n   * STEP 7: Save build data\n   */\n  async saveBuildData() {\n    const buildData = {\n      date: this.currentBuildDate.toISOString(),\n      dayNumber: window.gameManager.state.gameDay,\n      generated: this.generatedContent,\n      buildLog: this.buildLog,\n      gameState: {\n        npcCount: window.gameManager.npcs.size,\n        locationCount: window.gameManager.locations.size,\n        evidenceCount: window.gameManager.evidence.size,\n        kThaalAdaptation: window.gameManager.characters.kThaal.adaptationLevel\n      }\n    };\n\n    // Save locally\n    localStorage.setItem(\n      `destiny_build_${this.currentBuildDate.getTime()}`,\n      JSON.stringify(buildData)\n    );\n\n    // Save to IndexedDB for larger data\n    await this.saveToIndexedDB('destiny_builds', buildData);\n\n    this.log('üíæ Build data saved');\n  }\n\n  /**\n   * STEP 8: Update Perplexity Space with progress\n   */\n  async updatePerplexitySpace() {\n    console.log('üìù Updating Perplexity Space...');\n    \n    const progressReport = {\n      date: new Date().toISOString(),\n      dayNumber: window.gameManager.state.gameDay,\n      buildSummary: {\n        npcsGenerated: this.generatedContent.npcs.length,\n        locationsGenerated: this.generatedContent.locations.length,\n        questsGenerated: this.generatedContent.quests.length,\n        kThaalAdaptation: this.generatedContent.kThaalProgression.adaptationLevel,\n        totalNPCs: window.gameManager.npcs.size,\n        totalLocations: window.gameManager.locations.size\n      },\n      newContent: {\n        npcs: this.generatedContent.npcs.map(n => n.name),\n        locations: this.generatedContent.locations.map(l => l.name),\n        quests: this.generatedContent.quests.map(q => q.title)\n      }\n    };\n\n    // Create Perplexity Space update (simulated API call)\n    try {\n      await this.postToPerplexitySpace(progressReport);\n      this.log('‚úÖ Perplexity Space updated');\n    } catch (error) {\n      console.warn('Failed to update Perplexity Space:', error);\n    }\n  }\n\n  /**\n   * STEP 9: Commit to GitHub\n   */\n  async commitToGithub() {\n    console.log('üîó Committing to GitHub...');\n    \n    const commitMessage = `Daily Build ${this.currentBuildDate.toDateString()}: \n    - Generated ${this.generatedContent.npcs.length} NPCs\n    - Created ${this.generatedContent.locations.length} locations\n    - Added ${this.generatedContent.quests.length} quests\n    - K'Thaal adaptation: ${this.generatedContent.kThaalProgression.adaptationLevel}%`;\n\n    try {\n      // Simulated GitHub commit (implement actual API integration)\n      await this.pushToGithub('daily-build-data.json', {\n        timestamp: this.currentBuildDate.toISOString(),\n        content: this.generatedContent,\n        metrics: this.generateMetrics()\n      }, commitMessage);\n      \n      this.log('‚úÖ Committed to GitHub');\n    } catch (error) {\n      console.warn('Failed to commit to GitHub:', error);\n    }\n  }\n\n  /**\n   * Generate daily build report\n   */\n  generateBuildReport(startTime) {\n    const duration = (Date.now() - startTime) / 1000;\n    \n    return `\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë  DESTINY WORLD - DAILY BUILD REPORT      ‚ïë\n‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£\n‚ïë Date: ${this.currentBuildDate.toDateString()}\n‚ïë Game Day: ${window.gameManager.state.gameDay}\n‚ïë Build Duration: ${duration.toFixed(2)}s\n‚ïë\n‚ïë GENERATED CONTENT:\n‚ïë ‚Ä¢ NPCs: ${this.generatedContent.npcs.length}\n‚ïë ‚Ä¢ Locations: ${this.generatedContent.locations.length}\n‚ïë ‚Ä¢ Quests: ${this.generatedContent.quests.length}\n‚ïë ‚Ä¢ Dialogue Lines: ${this.generatedContent.dialogues.length}\n‚ïë ‚Ä¢ Story Events: ${this.generatedContent.events.length}\n‚ïë\n‚ïë GAME METRICS:\n‚ïë ‚Ä¢ Total NPCs: ${window.gameManager.npcs.size}\n‚ïë ‚Ä¢ Total Locations: ${window.gameManager.locations.size}\n‚ïë ‚Ä¢ K'Thaal Adaptation: ${this.generatedContent.kThaalProgression.adaptationLevel}%\n‚ïë ‚Ä¢ K'Thaal Followers: ${this.generatedContent.kThaalProgression.followersCount}\n‚ïë\n‚ïë BUILD ACTIONS:\n‚ïë ‚úÖ Content Generated\n‚ïë ‚úÖ K'Thaal Advanced\n‚ïë ‚úÖ Game Data Saved\n‚ïë ${this.config.perplexityEnabled ? '‚úÖ' : '‚è≠Ô∏è '} Perplexity Updated\n‚ïë ${this.config.githubEnabled ? '‚úÖ' : '‚è≠Ô∏è '} GitHub Committed\n‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n    `;\n  }\n\n  /**\n   * HELPER METHODS\n   */\n\n  log(message) {\n    this.buildLog.push({\n      timestamp: new Date().toISOString(),\n      message: message\n    });\n    console.log(`[BUILD] ${message}`);\n  }\n\n  async callPerplexitySonar(prompt) {\n    // TODO: Implement actual Perplexity Sonar API call\n    // For now, return placeholder\n    return JSON.stringify({});\n  }\n\n  async postToPerplexitySpace(data) {\n    // TODO: Implement Perplexity Space API integration\n  }\n\n  async pushToGithub(filename, data, message) {\n    // TODO: Implement GitHub API integration\n  }\n\n  async saveToIndexedDB(storeName, data) {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open('DestinyWorld', 1);\n      request.onsuccess = (e) => {\n        const db = e.target.result;\n        const transaction = db.transaction([storeName], 'readwrite');\n        const store = transaction.objectStore(storeName);\n        store.add(data);\n        resolve();\n      };\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  getLastBuildDate() {\n    const lastBuild = localStorage.getItem('destiny_last_build');\n    return lastBuild ? new Date(lastBuild) : new Date(0);\n  }\n\n  selectRandomNPC() {\n    const npcs = Array.from(window.gameManager.npcs.values());\n    return npcs[Math.floor(Math.random() * npcs.length)]?.id;\n  }\n\n  selectRandomLocation() {\n    const locations = Array.from(window.gameManager.locations.values());\n    return locations[Math.floor(Math.random() * locations.length)]?.id;\n  }\n\n  selectNPCForRecruitment() {\n    const npcs = Array.from(window.gameManager.npcs.values());\n    return npcs.find(npc => !npc.isCultist && npc.relationship < -10);\n  }\n\n  analyzePlayerBehavior() {\n    // Analyze how the player has been playing\n    return {\n      aggression: 'moderate',\n      stealth: 'high',\n      socialEngagement: 'selective',\n      morality: window.gameManager.state.playerAlignment\n    };\n  }\n\n  generateNPCSchedule() {\n    return {\n      morning: 'home',\n      afternoon: 'town_square',\n      evening: 'home',\n      night: 'home'\n    };\n  }\n\n  generateNPCDialogue(npcData) {\n    return [\n      `Hello, I'm ${npcData.name}. ${npcData.personality}`,\n      `Have you heard about the murders?`,\n      `I know something about ${npcData.secrets}`\n    ];\n  }\n\n  generateLocationExits() {\n    return ['town_square', 'forest_path', 'caves'];\n  }\n\n  generateLighting(dangerLevel) {\n    return dangerLevel > 70 ? 'dim' : 'moderate';\n  }\n\n  generateFallbackNPC(type) {\n    return {\n      id: `fallback_npc_${Date.now()}`,\n      name: `Mysterious ${type.charAt(0).toUpperCase() + type.slice(1)}`,\n      role: 'Unknown',\n      location: 'town_square',\n      relationship: 0,\n      faction: 'neutral'\n    };\n  }\n\n  generateFallbackLocation(type) {\n    return {\n      id: `fallback_loc_${Date.now()}`,\n      name: `Forgotten ${type.replace(/_/g, ' ')}`,\n      description: 'A strange place',\n      danger_level: 50,\n      exits: ['town_square']\n    };\n  }\n\n  generateFallbackQuest(type) {\n    return {\n      id: `fallback_quest_${Date.now()}`,\n      title: `The ${type} Mystery`,\n      description: 'Something needs investigation',\n      type: type,\n      alignment_impact: 0\n    };\n  }\n\n  generateMetrics() {\n    return {\n      totalPlayTime: window.gameManager.state.gameDay * 24, // hours\n      contentGenerated: this.generatedContent,\n      systemHealth: 'optimal'\n    };\n  }\n\n  generateCultEvent() {\n    return {\n      name: 'Cult Activity Detected',\n      type: 'cult',\n      severity: Math.floor(Math.random() * 100)\n    };\n  }\n\n  generateAllySuspicionEvent() {\n    return {\n      name: 'Ally Becomes Suspicious',\n      type: 'trust_test',\n      severity: Math.floor(Math.random() * 100)\n    };\n  }\n\n  generateAlienArtifactEvent() {\n    return {\n      name: 'Alien Artifact Discovered',\n      type: 'discovery',\n      severity: Math.floor(Math.random() * 100)\n    };\n  }\n\n  generatePlayerDream() {\n    return {\n      name: 'Disturbing Dream Vision',\n      type: 'psychological',\n      severity: Math.floor(Math.random() * 100)\n    };\n  }\n}\n\n// AUTO-SCHEDULER\nclass BuildScheduler {\n  constructor(pipeline) {\n    this.pipeline = pipeline;\n    this.scheduledTime = this.parseScheduleTime(pipeline.config.autoRunTime);\n  }\n\n  start() {\n    // Check every hour if it's time to build\n    setInterval(() => {\n      const now = new Date();\n      if (this.shouldRunBuild(now)) {\n        this.pipeline.executeDailyBuild();\n      }\n    }, 3600000); // Check every hour\n  }\n\n  shouldRunBuild(now) {\n    // Check if scheduled time has passed today\n    const lastBuild = new Date(localStorage.getItem('destiny_last_build') || 0);\n    const daysSinceLastBuild = (now - lastBuild) / (1000 * 60 * 60 * 24);\n    \n    return daysSinceLastBuild >= 1 && now.getHours() >= this.scheduledTime.hours;\n  }\n\n  parseScheduleTime(timeStr) {\n    const [hours, minutes] = timeStr.split(':').map(Number);\n    return { hours, minutes };\n  }\n}\n\n// Export\nif (typeof module !== 'undefined') {\n  module.exports = { DailyAutoBuildPipeline, BuildScheduler };\n}\n